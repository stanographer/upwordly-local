{"version":3,"file":"static/webpack/static/development/pages/view.js.7e30351f0c97456ff818.hot-update.js","sources":["webpack:///./src/components/LiveTranscript/index.jsx"],"sourcesContent":["import React, { Component, Fragment } from 'react';\nimport ShareDB from '@teamwork/sharedb/lib/client';\nimport ReconnectingWebSocket from 'reconnecting-websocket/dist/reconnecting-websocket';\nimport WS from 'isomorphic-ws';\nimport otText from 'ot-text';\nimport { ToastContainer } from 'react-toastify/index';\nimport {\n  CopiedToast,\n  DisconnectedToast,\n  FetchingToast,\n  ReconnectedToast\n} from '../Toasts';\n\nclass LiveTranscript extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this.state = {\n      connection: {},\n      doc: {},\n      flag: 'â‰ˆ',\n      loading: true,\n    };\n\n    this.hasDisconnected = false;\n  }\n\n  fetchDoc = host => {\n    const server = {\n      host: process.env.REACT_APP_ENV === 'production' ? 'upword.ly/ws' : host,\n      port: process.env.REACT_APP_ENV === 'production' ? '' : ':9090',\n      protocol: process.env.REACT_APP_ENV === 'production' ? 'wss://' : 'ws://',\n      getAddress: function () {\n        return this.protocol + this.host + this.port;\n      },\n    };\n\n    this.socket = new ReconnectingWebSocket(server.getAddress(), [], {\n      WebSocket: WS,\n      automaticOpen: true,\n      maxReconnectionDelay: 1000,\n      reconnectInterval: 1000,\n      maxReconnectInterval: 2000,\n      timeoutInterval: 2000,\n      maxRetries: Infinity,\n    });\n\n    ShareDB.types.register(otText.type);\n\n    const connection = new ShareDB.Connection(this.socket);\n\n    this.setState({\n      connection,\n      doc: connection.get(this.props.user, this.props.job),\n      loading: false,\n    });\n  };\n\n  componentDidMount() {\n\n    // HasConnected makes sure that the disconnection message isn't\n    // shown to the user at start-up.\n    CopiedToast();\n\n    this.fetchDoc(window.location.hostname);\n\n    // Will display a message to the user that the connection was lost.\n    this.socket.onclose = () => {\n      if (!this.hasDisconnected) {\n        DisconnectedToast();\n        this.hasDisconnected = true;\n      }\n    };\n\n    // Will display a message to the user that the connection is rectified.\n    this.socket.onopen = () => {\n      if (this.hasDisconnected) {\n        ReconnectedToast();\n        this.hasDisconnected = false;\n      }\n    };\n  }\n\n  render() {\n    const {loading} = this.state;\n\n    return (\n        <Fragment>\n          <ToastContainer\n              draggable\n              autoClose={ 5000 }\n          />\n          {\n            !loading\n                ? this.props.render(this.state)\n                : ''\n          }\n        </Fragment>\n    );\n  }\n}\n\nexport default LiveTranscript;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAxCA;AACA;AACA;AACA;AACA;AAJA;AAOA;AAVA;AAWA;AACA;;;AAgCA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;;;;AAtFA;AACA;AAwFA;;;;;A","sourceRoot":""}