{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Fragment } from 'react';\nimport Provider from '../../src/components/Session/Provider';\nimport Head from 'next/head';\nimport Router, { withRouter } from 'next/router';\nimport dynamic from 'next/dynamic';\nimport { auth, db } from '../../src/firebase';\nimport { withFirebase } from '../../src/firebase/context';\nimport * as ROUTES from '../../src/constants/routes';\nvar NavLogo = dynamic(function () {\n  return import('../../src/components/Logos/NavLogo');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../../src/components/Logos/NavLogo')];\n    },\n    modules: ['../../src/components/Logos/NavLogo']\n  }\n});\nvar Typed = dynamic(function () {\n  return import('react-typed');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('react-typed')];\n    },\n    modules: ['react-typed']\n  }\n}); // Sign-up components.\n\nvar EmailComponent = dynamic(function () {\n  return import('./Email');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./Email')];\n    },\n    modules: ['./Email']\n  }\n});\nvar NameAndLocation = dynamic(function () {\n  return import('./NameAndLocation');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./NameAndLocation')];\n    },\n    modules: ['./NameAndLocation']\n  }\n});\nvar PaymentComponent = dynamic(function () {\n  return import('./Payment');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./Payment')];\n    },\n    modules: ['./Payment']\n  }\n});\nvar TokenComponent = dynamic(function () {\n  return import('./Token');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./Token')];\n    },\n    modules: ['./Token']\n  }\n});\nvar UserInfoComponent = dynamic(function () {\n  return import('./UserInfo');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./UserInfo')];\n    },\n    modules: ['./UserInfo']\n  }\n});\nvar ValidFieldComponent = dynamic(function () {\n  return import('./ValidField');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./ValidField')];\n    },\n    modules: ['./ValidField']\n  }\n});\nvar INITIAL_STATE = {\n  email: '',\n  emailValid: false,\n  errors: [],\n  formValid: false,\n  fullName: '',\n  fullNameValid: false,\n  location: {},\n  locationValid: false,\n  password: '',\n  passwordValid: false,\n  payment: '',\n  step: 0,\n  token: '',\n  tokenValid: false,\n  username: '',\n  usernameValid: false\n};\n\nvar SignUp =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(SignUp, _React$Component);\n\n  function SignUp(props) {\n    var _this;\n\n    _classCallCheck(this, SignUp);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SignUp).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleInput\", function (e) {\n      // Matches the token to the one in the environment variable.\n      // Trims and lower-cases. If there's a match, the tokenValid\n      // flag is switched to true.\n      if (e.target.name === 'token') {\n        _this.setState(_defineProperty({}, e.target.name, e.target.value.trim().toLowerCase()));\n      } else if (e.target.name === 'email') {\n        _this.setState({\n          email: e.target.value.trim().toLowerCase()\n        });\n      } else if (e.target.name === 'username') {\n        _this.setState({\n          username: e.target.value.toLowerCase()\n        });\n      } else {\n        _this.setState(_defineProperty({}, e.target.name, e.target.value));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (e) {\n      var _this$state = _this.state,\n          email = _this$state.email,\n          emailValid = _this$state.emailValid,\n          fullName = _this$state.fullName,\n          fullNameValid = _this$state.fullNameValid,\n          location = _this$state.location,\n          locationValid = _this$state.locationValid,\n          password = _this$state.password,\n          passwordValid = _this$state.passwordValid,\n          payment = _this$state.payment,\n          token = _this$state.token,\n          tokenValid = _this$state.tokenValid,\n          username = _this$state.username,\n          usernameValid = _this$state.usernameValid;\n\n      if (emailValid && fullNameValid && locationValid && passwordValid && tokenValid && usernameValid) {\n        auth.doCreateUserWithEmailAndPassword(email, password).then(function (authUser) {\n          db.doCreateUser(email, fullName, _JSON$stringify(location), authUser.user.uid, payment, token, username).then(function () {\n            _this.setState(function () {\n              return _objectSpread({}, INITIAL_STATE);\n            });\n\n            Router.push(ROUTES.DASHBOARD);\n          })[\"catch\"](function (err) {\n            return _this.setState({\n              errors: [].concat(_toConsumableArray(_this.state.errors), [err.message])\n            });\n          });\n        })[\"catch\"](function (err) {\n          return _this.setState({\n            errors: [].concat(_toConsumableArray(_this.state.errors), [err.message])\n          });\n        });\n      }\n\n      e.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateStepZero\", function (token) {\n      if (token === process.env.REGISTRATION_TOKEN.trim().toLowerCase()) {\n        _this.setState({\n          errors: [],\n          step: _this.state.step += 1,\n          tokenValid: true\n        });\n      } else {\n        _this.setState({\n          errors: ['Sorry. Your token is invalid.']\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateStepOne\", function () {\n      var _this$state2 = _this.state,\n          fullName = _this$state2.fullName,\n          location = _this$state2.location;\n      var re = /^[A-Za-z0-9 _]*[A-Za-z0-9][A-Za-z0-9 _]*$/;\n\n      if (!fullName.match(re)) {\n        _this.setState({\n          errors: [].concat(_toConsumableArray(_this.state.errors), ['Your name can only contain alphanumeric characters.'])\n        });\n      } else if (location.description === undefined) {\n        _this.setState({\n          errors: [].concat(_toConsumableArray(_this.state.errors), ['Select the closest matching location.'])\n        });\n      } else {\n        _this.setState({\n          errors: [],\n          fullNameValid: true,\n          locationValid: true,\n          step: _this.state.step += 1\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateStepTwo\", function (email) {\n      try {\n        // Regex to make sure that emails have @ signs and all that.\n        var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/; // Testing to see if the email matches the regex.\n\n        if (!re.test(String(email).trim().toLowerCase())) {\n          _this.setState({\n            errors: ['Your email is badly formatted.']\n          });\n        } else {\n          // Makes sure that there's no duplicate emails.\n          db.checkDupeEmail(email, function (dupe) {\n            if (dupe === true) {\n              _this.setState({\n                errors: ['An account with this email address already exists.']\n              });\n            } else {\n              _this.setState({\n                emailValid: true,\n                errors: [],\n                step: _this.state.step += 1\n              });\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateStepThree\", function (username, password) {\n      var usernameRe = /^[a-zA-Z0-9_-]+$/;\n      var passwordRe = /^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?&])[A-Za-z\\d@$!%*#?&]{8,}$/;\n\n      if (!username.match(usernameRe)) {\n        _this.setState({\n          errors: [].concat(_toConsumableArray(_this.state.errors), ['Your username may only contain lowercase letters, numbers, hyphens, and underscores.'])\n        });\n      } else if (!password.match(passwordRe)) {\n        _this.setState({\n          errors: [].concat(_toConsumableArray(_this.state.errors), ['Your password needs at minimum eight characters, at least one letter, one number, and one special character.'])\n        });\n      } else {\n        db.checkDupeUsername(username.trim().toLowerCase(), function (dupe) {\n          if (dupe === true) {\n            _this.setState({\n              errors: ['This username is already taken.']\n            });\n          } else {\n            _this.setState({\n              errors: [],\n              step: _this.state.step += 1,\n              usernameValid: true,\n              passwordValid: true\n            });\n          }\n        });\n      }\n    });\n\n    _this.state = _objectSpread({}, INITIAL_STATE);\n    return _this;\n  }\n\n  _createClass(SignUp, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state3 = this.state,\n          email = _this$state3.email,\n          errors = _this$state3.errors,\n          fullName = _this$state3.fullName,\n          location = _this$state3.location,\n          password = _this$state3.password,\n          payment = _this$state3.payment,\n          step = _this$state3.step,\n          token = _this$state3.token,\n          username = _this$state3.username;\n\n      var stage = function stage() {\n        switch (step) {\n          case 0:\n            return React.createElement(TokenComponent, {\n              errors: errors,\n              tokenValue: token,\n              handleInput: _this2.handleInput,\n              nextStep: _this2.validateStepZero\n            });\n\n          case 1:\n            return React.createElement(Fragment, null, React.createElement(ValidFieldComponent, {\n              message: \"Your registration token \\\"\".concat(token, \"\\\" is valid.\")\n            }), React.createElement(NameAndLocation, {\n              errors: errors,\n              fullNameValue: fullName,\n              handleInput: _this2.handleInput,\n              locationValue: location,\n              nextStep: _this2.validateStepOne\n            }));\n\n          case 2:\n            return React.createElement(Fragment, null, React.createElement(ValidFieldComponent, {\n              message: \"Your registration token \\\"\".concat(token, \"\\\" is valid.\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"Nice to meet you, \".concat(fullName, \"! I hear the weather is great in \").concat(location.description, \"!\")\n            }), React.createElement(EmailComponent, {\n              emailValue: email,\n              errors: errors,\n              handleInput: _this2.handleInput,\n              nextStep: _this2.validateStepTwo\n            }));\n\n          case 3:\n            return React.createElement(Fragment, null, React.createElement(ValidFieldComponent, {\n              message: \"Your registration token \\\"\".concat(token, \"\\\" is valid.\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"Nice to meet you, \".concat(fullName, \"! I hear the weather is great in \").concat(location.description, \"!\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"\".concat(email, \" is a valid and available email address.\")\n            }), React.createElement(UserInfoComponent, {\n              errors: errors,\n              handleInput: _this2.handleInput,\n              passwordValue: password,\n              usernameValue: username,\n              nextStep: _this2.validateStepThree\n            }));\n\n          case 4:\n            return React.createElement(Fragment, null, React.createElement(ValidFieldComponent, {\n              message: \"Your registration token \\\"\".concat(token, \"\\\" is valid.\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"Nice to meet you, \".concat(fullName, \"! I hear the weather is great in \").concat(location.description, \"!\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"\".concat(email, \" is a valid and available email address.\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"\".concat(username, \" is a valid and available username!\")\n            }), React.createElement(ValidFieldComponent, {\n              message: \"Nice and strong password!\"\n            }), React.createElement(PaymentComponent, {\n              errors: errors,\n              handleInput: _this2.handleInput,\n              paymentValue: payment,\n              finish: _this2.handleSubmit\n            }));\n\n          default:\n            break;\n        }\n      };\n\n      return React.createElement(Provider, null, React.createElement(Head, null, React.createElement(\"title\", null, \"Create an Upword.ly account\"), React.createElement(\"meta\", {\n        name: \"viewport\",\n        content: \"initial-scale=1.0, width=device-width\",\n        key: \"viewport\"\n      })), React.createElement(\"div\", {\n        className: \"container mx-auto h-full flex flex-1 justify-center items-center\"\n      }, React.createElement(\"div\", {\n        className: \"w-full max-w-sm mt-20\"\n      }, React.createElement(NavLogo, {\n        center: true\n      }), React.createElement(\"div\", {\n        className: \"font-sans mb-10 mt-2 text-center justify-center\"\n      }, React.createElement(Typed, {\n        className: \"marquee\",\n        strings: ['Welcome to Upword.ly.', 'Let\\'s create you an account.'],\n        typeSpeed: 40\n      })), stage(), React.createElement(\"p\", {\n        className: \"text-center text-grey text-xs mt-10\"\n      }, \"\\xA92019 Upword.ly. All rights reserved.\"))));\n    }\n  }]);\n\n  return SignUp;\n}(React.Component);\n\nexport default withFirebase(withRouter(SignUp));","map":null,"metadata":{},"sourceType":"module"}